zos-academy.fr {
  @labs path /labs /labs/*

  handle @labs {
    forward_auth auth:8081 {
      uri /api/verify
      copy_headers Set-Cookie
    }
    uri strip_prefix /labs
    reverse_proxy navigateur:80
  }

  handle_errors 401 {
    @unauth {
      expression {err.status_code} == 401
    }
    handle @unauth {
      redir / 302
    }
  }

  handle {
    reverse_proxy auth:8081
  }

  encode gzip
}

www.zos-academy.fr {
  redir https://zos-academy.fr{uri} permanent
}
